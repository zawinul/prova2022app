const jose = require('node-jose');

const token = "eyJraWQiOiJmV25mNTc3NXp6MGtmeHBna1lDekJQUWNieTcrZ3dPS0NDbkt6emg0MnNFPSIsImFsZyI6IlJTMjU2In0.eyJvcmlnaW5fanRpIjoiMzU3OTIzNTgtYmE4Yi00MTljLWE5MmUtZWRhZjcwNjUxZjA3Iiwic3ViIjoiOTA4MjRiYWUtNTYyMi00Yjg5LTlkYTYtZTBlYTAyNzU1YjhiIiwidG9rZW5fdXNlIjoiYWNjZXNzIiwic2NvcGUiOiJhd3MuY29nbml0by5zaWduaW4udXNlci5hZG1pbiBwaG9uZSBvcGVuaWQgcHJvZmlsZSBlbWFpbCIsImF1dGhfdGltZSI6MTY1MTA1MzU4NiwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tXC91cy1lYXN0LTFfU2dOWTZUVEpRIiwiZXhwIjoxNjUxMDU3MTg2LCJpYXQiOjE2NTEwNTM1ODYsInZlcnNpb24iOjIsImp0aSI6IjhjNWViMmE4LTVhZTItNDQwOC1hZTcxLTY4ZDM2ODM2MGQwMSIsImNsaWVudF9pZCI6IjN1NjAwZ2ttZDFrcDU0dGM0NTRhMGM0NDFtIiwidXNlcm5hbWUiOiJwYW9sbzMifQ.Jg0N_b59hcw_1ZWsHF5e6-2qwDo6zni4PBtwMK2jHn9-sOSv5tSiUuh3aiUXqJjukSq3bsxMqM53h2iPkMx9ESy7_JEBBn3h2R5dY50cmagJq6pOpAPIc33wEc5ILOPAY2Hbk-8pmLubq3WjifWGVXBpPAb4KtQDyMXe5rImMpBDShmVLUz2tIGcf2GFzjFSJnwwIc9R7dVq1U4WougZD-IiB2kOL_XpdJwT42_ViwrEPtcXTqE7Ei3ZiCrYPE_GJsRHigmAt3vtEEzz6qNjCnHoMVMW-fSLGm8BynWqwJjB_TRCu3w8W6BLABttE6jW-u3DaHq18pxVO11Miqdq6A";
const qm4aiikzzM1TvMrhJYzpU4WODCR7FtJts4EHNOpwbd0IR124Er51ut1VtgAAvmUjKdFC9zs97oBXFWwbjva_SkeVhKqySUWjpnjq04hGrLNf2ePVKWP_OVVqsM0MLuBjYYX_HFsLuSG_txNqXvoFNMQGUChce7zRsPE6DB5Oa6X8 = "eyJraWQiOiJmV25mNTc3NXp6MGtmeHBna1lDekJQUWNieTcrZ3dPS0NDbkt6emg0MnNFPSIsImFsZyI6IlJTMjU2In0.eyJvcmlnaW5fanRpIjoiMzU3OTIzNTgtYmE4Yi00MTljLWE5MmUtZWRhZjcwNjUxZjA3Iiwic3ViIjoiOTA4MjRiYWUtNTYyMi00Yjg5LTlkYTYtZTBlYTAyNzU1YjhiIiwidG9rZW5fdXNlIjoiYWNjZXNzIiwic2NvcGUiOiJhd3MuY29nbml0by5zaWduaW4udXNlci5hZG1pbiBwaG9uZSBvcGVuaWQgcHJvZmlsZSBlbWFpbCIsImF1dGhfdGltZSI6MTY1MTA1MzU4NiwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tXC91cy1lYXN0LTFfU2dOWTZUVEpRIiwiZXhwIjoxNjUxMDU3MTg2LCJpYXQiOjE2NTEwNTM1ODYsInZlcnNpb24iOjIsImp0aSI6IjhjNWViMmE4LTVhZTItNDQwOC1hZTcxLTY4ZDM2ODM2MGQwMSIsImNsaWVudF9pZCI6IjN1NjAwZ2ttZDFrcDU0dGM0NTRhMGM0NDFtIiwidXNlcm5hbWUiOiJwYW9sbzMifQ.Jg0N_b59hcw_1ZWsHF5e6-2qwDo6zni4PBtwMK2jHn9-sOSv5tSiUuh3aiUXqJjukSq3bsxMqM53h2iPkMx9ESy7_JEBBn3h2R5dY50cmagJq6pOpAPIc33wEc5ILOPAY2Hbk-8pmLubq3WjifWGVXBpPAb4KtQDyMXe5rImMpBDShmVLUz2tIGcf2GFzjFSJnwwIc9R7dVq1U4WougZD-IiB2kOL_XpdJwT42_ViwrEPtcXTqE7Ei3ZiCrYPE_GJsRHigmAt3vtEEzz6qNjCnHoMVMW-fSLGm8BynWqwJjB_TRCu3w8W6BLABttE6jW-u3DaHq18pxVO11ABCDEF";
async function test(code, state) {

	let jcert=`
	{"keys":[{"alg":"RS256","e":"AQAB","kid":"Y4TJMlDvA3569lxRfRO/n/7Hzzx8UqL7j0RCf8mZaAg=","kty":"RSA","n":"qm4aiikzzM1TvMrhJYzpU4WODCR7FtJts4EHNOpwbd0IR124Er51ut1VtgAAvmUjKdFC9zs97oBXFWwbjva_SkeVhKqySUWjpnjq04hGrLNf2ePVKWP_OVVqsM0MLuBjYYX_HFsLuSG_txNqXvoFNMQGUChce7zRsPE6DB5Oa6X8-MzgRGO63MXf5aOa1DLn08XtobfivgesLvZwaFlnyG2wu49gLKyy50svFQ86Xz8MUZP-VpeN1i2jdmXa8-QVjRV9dAmjf9afytWJsHoAYWDNy4xj0WUaLw9zRDj5JYqtsTOo8gb6XQOjXl7vxDzoXsbwklfuMy4wmrfsOGChdw","use":"sig"},{"alg":"RS256","e":"AQAB","kid":"fWnf5775zz0kfxpgkYCzBPQcby7+gwOKCCnKzzh42sE=","kty":"RSA","n":"wx2v0TuSGrsgThaVcpxvHg9zhPLxpwjYpselgFhZWxEwtoCeXk6bSy74PIKrHj7sOfs8l-FnXzYHCepVoI-gvidGgLEY-aFOURc3_-cfjqOJPBY6geTA8g-aAsUvbtXDttsT-jEqOGhbnHcz0a1cYjQw97HUP3h59P_IZwvnMQUtvxtqftVSiLFyAOwp0gqNi0_p4Abd2csLOKkYZ7O_qMfRgYH__0fI5grvhw0a3ZIkwI7UO9-kfI-sqQopR_zJKotk71W4N-rxO6If9eGI0vz7ss4a-4TYzjuqNulsfGI0uVXI0KveQzEK7jtaJ6DMOoVaWIAtMLhGr1-oqElTrQ","use":"sig"}]}`;
	let ks = await jose.JWK.asKeyStore(jcert);
	console.log(ks);
	let everything = ks.all();
	console.log(everything);

	try {
		let result = await jose.JWS.createVerify(ks).verify(token);
		if (result.payload)
			result.payload= result.payload.toString('utf8')
		console.log(JSON.stringify({ok:result},null,2));
	}
	catch(e) {
		console.log('fail: '+e);
	}
	return 'ok';
}

test().then(console.log,console.log);